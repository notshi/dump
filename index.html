<!DOCTYPE HTML>
<html id="top" lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width">
		<meta name="theme-color" content="#142334">
		<title>_ d _ u _ m _ p _ </title>
		<!-- Copyright (c) 2022-present, shi Blank
		Licensed under the MIT license whose full text can be found at http://opensource.org/licenses/MIT -->
		<style>
			/*! minireset.css v0.0.3 | MIT License | github.com/jgthms/minireset.css */html,body,p,ol,ul,li,dl,dt,dd,blockquote,figure,fieldset,legend,textarea,pre,iframe,hr,h1,h2,h3,h4,h5,h6{margin:0;padding:0}h1,h2,h3,h4,h5,h6{font-size:100%;font-weight:normal}ul{list-style:none}button,input,select,textarea{margin:0}html{box-sizing:border-box}*,*:before,*:after{box-sizing:inherit}img,embed,iframe,object,audio,video{height:auto;max-width:100%}iframe{border:0}table{border-collapse:collapse;border-spacing:0}td,th{padding:0;text-align:left}
			
			html		{scroll-behavior:smooth;}
			body, html	{-webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; font-weight:normal; font-style:normal;}
			body		{background:#f2f2f2; font-family:sans-serif; font-size:1rem; line-height:1.5; color:#444;}
			body		{display:grid; height:100vh; grid-template-rows:auto 1fr auto;}
			h1		{font-size:4em; font-weight:normal; color:#1400ff;}
			h2		{font-size:2em; font-weight:normal;}
			h3		{font-size:1.3em; font-weight:bold;}
			a		{text-decoration:none;}
			p		{margin:0.5em 0;}
			img		{max-width:100%; height:auto;}
			.wrap		{background:#fff;}
			.head_wrap	{padding:2em 0; margin:0 auto;}
			.info_wrap	{padding:2em 0 0 7px;}
			.foot_wrap,
			.table_wrap	{max-width:1280px; width:960px; padding:2em 4em; margin:0 auto;}
			.table_wrap	{font-size:12px; line-height:1.5em;}
			
			#test		{font-family:monospace; font-size:1px; overflow:wrap; margin:0 auto;}
			
			#col_title,
			#col_date,
			#col_run,
			#col_time,
			#col_tix,
			#col_url	{display:inline-block; vertical-align:top;}
			
			a.url_tix,
			a.url_abt	{display:block; padding:3px 10px; font-size:12px; text-align:center; color:#fff; border-radius:4px;}
			a.url_tix	{background-color:#056b9c; font-weight:bold;}
			a.url_tix:hover	{background-color:#499fc9;}
			a.url_abt	{background-color:#747474;}
			a.url_abt:hover	{background-color:#969696;}
			
			.foot_wrap	{font-size:14px;}
			.foot_cont	{box-sizing:border-box; display:inline-block; padding-right:1em; width:100%; vertical-align:top;}
			.foot_small	{font-size:12px;}
			.foot_bold	{font-weight:bold;}
			.foot_bold p	{margin:1.5em 0;}
			span#date	{font-style:italic;}
			
			/*	Back to top link	*/
			a.top		{display:block; width:100%; padding:20px 0; text-align:center; font-size:12px; color:#444; cursor:pointer;}
			a.top:hover	{background-color:#F8F8F8;}
			
			/*	Extra style	*/
			.info		{text-align:center;}
			.c-st		{display:inline-block; padding:3px 5px; border-radius:50px; background:#a2a2a2; color:#fff; font-weight:bold; font-size:10px;}
			.c-Silver,
			.c-baby		{font-weight:bold; font-size:10px; color:#666; letter-spacing:1px;}
			.c-aut		{color:#a403ff; font-weight:bold; letter-spacing:2px; font-variant:all-small-caps;}
			
			/*	Tablesort style	*/
			table		{background:#fff; max-width:100%; border-spacing:0; width:100%; margin:10px 0; border:1px solid #ddd; border-collapse:separate;
			*border-collapse:collapsed; -webkit-box-shadow:0 0 4px rgba(0,0,0,0.10); -moz-box-shadow:0 0 4px rgba(0,0,0,0.10); box-shadow:0 0 4px rgba(0,0,0,0.10);}
			table th,
			table td	{padding:6px; line-height:18px; text-align:left; border-top:1px solid #ddd;}
			table th	{background:#eee; background:-webkit-gradient(linear, left top, left bottom, from(#f6f6f6), to(#eee)); background:-moz-linear-gradient(top, #f6f6f6, #eee); text-shadow:0 1px 0 #fff; font-weight:bold; vertical-align:bottom;}
			table td	{vertical-align:middle;}
			table thead:first-child tr th,
			table thead:first-child tr td			{border-top:0;}
			table tbody + tbody				{border-top:2px solid #ddd;}
			table th + th,
			table td + td,
			table th + td,
			table td + th					{border-left:1px solid #ddd;}
			table thead:first-child tr:first-child th,
			table tbody:first-child tr:first-child th,
			table tbody:first-child tr:first-child td	{border-top:0;}
			table td:first-child				{font-size:14px;}
			table tr.over					{background-color:#f1f1f1; color:#afaeae;}

			th[role=columnheader]:not(.no-sort)		{cursor:pointer;}
			th[role=columnheader]:not(.no-sort):after	{content:''; float:right; margin-top:7px; border-width:0 4px 4px; border-style:solid; border-color:#404040 transparent; visibility:hidden; opacity:0; -ms-user-select:none; -webkit-user-select:none; -moz-user-select:none; user-select:none;}
			th[aria-sort=ascending]:not(.no-sort):after	{border-bottom:none; border-width:4px 4px 0;}
			th[aria-sort]:not(.no-sort):after		{visibility:visible; opacity:0.4;}
			th[role=columnheader]:not(.no-sort):hover:after	{visibility:visible; opacity:1;}

			
			/*	PHONES & STUFF
				============================================= */
				
			@media only screen and (-webkit-min-device-pixel-ratio: 1.5),
			only screen and (-o-min-device-pixel-ratio: 3/2),
			only screen and (min--moz-device-pixel-ratio: 1.5),
			only screen and (min-device-pixel-ratio: 1.5) {

			.head_wrap	{padding:1em; margin:0 auto; line-height:2em;}
			.foot_wrap	{padding:2em; font-size:12px;}
			.table_wrap	{padding:1vh; max-width:initial;}
			span#date	{display:block; padding-top:1em;}

			}
		</style>
	</head>
	<body><div id="test" style="width:960px;"></div>
		<div class="table_wrap">
			<div class="head_wrap"><h2>Movies at the <span class="cinema_name">Bradford</span> Light Cinema</h2></div>
			<table id="table_summary">
				<thead>
				<tr>
					<th class="title_head">Title</th>
					<th class="run_head">Runtime</th>
					<th>First Show</th>
					<th>Last Show</th>
					<th>Count</th>
				</tr>
				</thead>
				<tbody id="list"></tbody>
			</table>
		</div>
		<div class="table_wrap">
			<div class="head_wrap"><h2>Showings</h2></div>
			<table id="table_list">
				<thead>
				<tr>
					<th class="title_head">Title</th>
					<th>Info</th>
					<th data-sort-default>date</th>
					<th>start</th>
					<th>finish</th>
				</tr>
				</thead>
				<tbody id="dump"></tbody>
			</table>
		</div>
		<div class="wrap">
			<div class="foot_wrap">
				<div class="foot_cont">
					<div class="foot_bold"><p>About</p></div>
					<div class="foot_text">
						<p>Live movie showings at The Light Cinema <span class="cinema_name">Bradford</span> in a sortable list.</p>
						<p>Try Also :</p>
						<a href="?cinema=Addlestone">Addlestone</a>
						<a href="?cinema=Banbury">Banbury</a>
						<a href="?cinema=Bolton">Bolton</a>
						<a href="?cinema=Bradford">Bradford</a>
						<a href="?cinema=Cambridge">Cambridge</a>
						<a href="?cinema=NewBrighton">NewBrighton</a>
						<a href="?cinema=Sheffield">Sheffield</a>
						<a href="?cinema=SittingBourne">SittingBourne</a>
						<a href="?cinema=Stockport">Stockport</a>
						<a href="?cinema=Thetford">Thetford</a>
						<a href="?cinema=Walsall">Walsall</a>
						<a href="?cinema=Wisbech">Wisbech</a>
				</div>
					<div class="foot_bold"><p><a href="http://github.com/notshi/dump">dump is on Github</a></p></div>
					<div class="foot_small">Project by Wetgenes, 2022-present</div>
				</div>
			</div>
			<a href="#top" class="top">BACK TOP</a>
		</div>
	</body>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/tablesort/5.2.1/tablesort.min.js" type="text/javascript"></script>
	<script>
		function getQueryVariable(variable) {
			var query = window.location.search.substring(1);
			if(query)
			{
				var vars = query.split('&');
				for (var i = 0; i < vars.length; i++) {
					var pair = vars[i].split('=');
					if (decodeURIComponent(pair[0]) == variable) {
						return decodeURIComponent(pair[1]);
					}
				}
			}
		}
		var cinema=getQueryVariable("cinema") || "Bradford"
		for( span of document.getElementsByClassName("cinema_name") )
		{
			console.log(span)
			span.innerHTML=cinema
		}
		var script = document.createElement('script');
		script.src = "https://"+cinema.toLowerCase()+".thelight.co.uk/resource/services/miniguide/data.ashx";
		document.head.appendChild(script);

		window.gfdx = function(a)
		{
			var dat=window.__gfminiguidedata;

console.log(dat)

			const dump = document.getElementById("dump");
			const list = document.getElementById("list");
			
			//document.getElementById("test").innerText=JSON.stringify(dat)
			
			let movies = {};
			let getmovie = function(name)
			{
				let movie = movies[name];
				if (!movie)
				{
				    movie = {};
				    movies[name] = movie;
				}
				return movie;
			}
			
			let get_date=function(d){
				let aa  = String(d).split(" ");
				let ab  = aa[4].split(":")
				return aa[1]+' '+aa[2]+' '+aa[0];
			}
			let get_time=function(d){ return ("0"+d.getHours()).slice(-2)+":"+("0"+d.getMinutes()).slice(-2) }

			let daymap={}

			for (let it of dat.Schedule)
			{
//				console.log(it.Title)
//				console.log(it)
				for (let d of it.Dates)
				{
//					console.log(d.Display)
//					console.log(d)
					for (let s of d.Sessions)
					{
//						console.log(s.Display)
//						console.log(s)

							let symbol    = null;
							let hovertxt  = null;
							for (let c of s.Collections)
							{
								if ( c.ID != 1823 ){ symbol    = c.Symbol; }
								if ( c.ID != 1823 ){ hovertxt  = c.Hover; }
							}
							
							let year      = parseInt(d.Key.slice(0,4));
							let month     = parseInt(d.Key.slice(4,6));
							let day       = parseInt(d.Key.slice(6,8));
							let timesplit = s.Display.split(".");
							let hour      = timesplit[0];
							let minute    = timesplit[1];
							hour          = parseInt(hour);
							minute        = parseInt(minute);
							
							let newdate   = new Date(year, month-1, day, hour, minute);		// date and time grouped
							let unix      = newdate.getTime();					// unix time stamp
							
							let runhour     = 0;
							let runminute   = 0;
							let ss   = it.Runtime.split(" ");
							if(ss.length==2)
							{
								runhour     = parseInt(ss[0]);
								runminute   = parseInt(ss[1]);
							}
							else
							{
								runminute   = parseInt(ss[0]);
							}
							let runtime     = runhour*60 + runminute;
							let whendate    = d.Display.split(" ");				// runtime converted to minutes

							let start_time=new Date(newdate.getTime())
							let finish_time=new Date(newdate.getTime()+((runtime+20)*60*1000))

							const tr      = document.createElement("tr");
							const title   = document.createElement("td");
							const finish  = document.createElement("td");
							const info    = document.createElement("td");
							const date    = document.createElement("td");
							const time    = document.createElement("td");
							const tix     = document.createElement("td");
							const when    = document.createElement("td");
							
							title.className = 'title';
							finish.className   = 'run';
							info.className  = 'info';
							date.className  = 'date';
							time.className  = 'time';
							tix.className   = 'tix';
							when.className  = 'when';
														
							if ( unix < ( new Date() ).getTime() ){ tr.className = 'over'; }
							
							date.setAttribute("data-sort",String(start_time.getTime()).padStart(16,"0"));
							time.setAttribute("data-sort",String(start_time.getTime()).padStart(16,"0"));
							finish.setAttribute("data-sort",String(finish_time.getTime()).padStart(16,"0"));
							when.setAttribute("data-sort",String(start_time.getTime()).padStart(16,"0"));
							info.setAttribute("title",hovertxt);
    
							title.innerHTML+= "<a href='https://"+cinema.toLowerCase()+".thelight.co.uk"+it.Url+"' target='_blank'>"+it.Title+"</a>";
							finish.innerHTML  += get_time(finish_time) // runtime+"m";
							info.innerHTML += symbol || "";
							date.innerHTML += get_date(start_time);
							time.innerHTML += get_time(start_time);
							tix.innerHTML  += "<a class='url_tix' href='"+s.Url+"' target='_blank'>BUY</a>";
							when.innerHTML += whendate[2]+" "+whendate[1]+" ("+s.Display+") "+whendate[0];
							
							dump.appendChild(tr);
							tr.appendChild(title);
							tr.appendChild(info);
							tr.appendChild(date);
							tr.appendChild(time);
							tr.appendChild(finish);
//							tr.appendChild(when);
//							tr.appendChild(tix);
							
							
							
							let movie    = getmovie(it.Title);
							movie.title  = "<a href='https://"+cinema.toLowerCase()+".thelight.co.uk"+it.Url+"' target='_blank'>"+it.Title+"</a>";;
							movie.run    = runtime;
//							movie.runraw = it.Runtime;
							movie.url    = "<a class='url_abt' href='https://"+cinema.toLowerCase()+".thelight.co.uk"+it.Url+"' target='_blank'>ABOUT</a>";
							
							if ( !movie.first ){ movie.first=newdate }
							if ( !movie.last  ){ movie.last =newdate }
							if ( movie.first.getTime() > newdate.getTime() ){ movie.first=newdate }
							if ( movie.last.getTime()  < newdate.getTime() ){ movie.last =newdate }
							
							movie.count  = movie.count || 0;
							movie.count  ++
							
							daymap[ Math.floor(start_time.getTime()/(1000*60*60*24)) ]=true
							daymap[ Math.floor(start_time.getTime()/(1000*60*60*24))+1 ]=true

					}
				}
			}
			
			for( t in daymap )
			{
				let d1=new Date(t*(1000*60*60*24))
				let d2=String(d1.getTime()).padStart(16,"0")

				const tr      = document.createElement("tr");
				const title   = document.createElement("td");
				const finish  = document.createElement("td");
				const info    = document.createElement("td");
				const date    = document.createElement("td");
				const time    = document.createElement("td");
				
				tr.className = 'over';
				
				title.className = 'title';
				finish.className   = 'run';
				info.className  = 'info';
				date.className  = 'date';
				time.className  = 'time';

				date.setAttribute("data-sort",d2);
				time.setAttribute("data-sort",d2);
				finish.setAttribute("data-sort",d2);

//				date.innerHTML += get_date(d1);
				
				dump.appendChild(tr);
				tr.appendChild(title);
				tr.appendChild(info);
				tr.appendChild(date);
				tr.appendChild(time);
				tr.appendChild(finish);
			}

			
			for (let name in movies)
			{
			    let movie = movies[name];
			    
			    const tr      = document.createElement("tr");
			    const title   = document.createElement("td");
			    const run     = document.createElement("td");
			    const first   = document.createElement("td");
			    const last    = document.createElement("td");
			    const count   = document.createElement("td");
//			    const url     = document.createElement("td");
			    
			    let runsort      = document.createAttribute("data-sort");
			    let countsort    = document.createAttribute("data-sort");
			    runsort.value    = String(movie.run).padStart(4,"0");
			    countsort.value  = String(movie.count).padStart(4,"0");
			    
			    let getdate = function(d)
			    {
				let aa  = String(d).split(" ");
				let ab  = aa[4].split(":")
				return aa[1]+' '+aa[2]+' ('+ab[0]+':'+ab[1]+') '+aa[0];
			    }
			    
			    title.className  = 'title';
			    run.className    = 'run';
			    first.className  = 'first';
			    last.className   = 'last';
			    count.className  = 'count';
//			    url.className    = 'url';
			    title.innerHTML += movie.title;
			    run.innerHTML   += movie.run+"m";//+Math.floor(movie.run/6)/10+"h";
			    first.innerHTML += getdate(movie.first);
			    last.innerHTML  += getdate(movie.last);
			    count.innerHTML += movie.count;
//			    url.innerHTML   += movie.url;
			    
			    run.setAttributeNode(runsort);
			    count.setAttributeNode(countsort);
			    
			    list.appendChild(tr);
			    tr.appendChild(title);
			    tr.appendChild(run);
			    tr.appendChild(first);
			    tr.appendChild(last);
			    tr.appendChild(count);
//			    tr.appendChild(url);
			    
			}

// tell tables to sort
			new Tablesort(document.getElementById("table_list"));
			new Tablesort(document.getElementById("table_summary"));

		}

	</script>
</html>
